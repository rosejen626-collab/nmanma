<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>寵物美容服務定型化契約</title>

  <style>
:root{
  --bg:#FFF5F8;          
  --card:#FFFFFF;       
  --border:#F0C6D3;     
  --muted:#A77A8A;      
  --text:#4A2E36;       
  --danger:#C94A6A;     
}

#msg {
  text-align: center;
  margin-top: 12px;
  line-height: 1.6;
}

*{box-sizing:border-box}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,"Noto Sans TC","PingFang TC","Heiti TC",sans-serif;
}

.wrap{
  max-width:720px;
  margin:0 auto;
  padding:16px 14px 40px;
}

.card{
  background:var(--card);
  border-radius:22px;
  padding:18px 16px;
  box-shadow:0 2px 14px rgba(224,122,154,.18);
  margin:14px 0;
}

.title{
  font-size:28px;
  font-weight:900;
  margin-bottom:10px;
}

.label{
  font-size:22px;
  font-weight:900;
  margin:18px 0 10px;
}

.input{
  width:100%;
  border:2px solid var(--border);
  border-radius:18px;
  padding:14px;
  font-size:20px;
  font-weight:900;
  background:#fff;
  color:var(--text);
}

#signDate{
  height:58px;
  padding:14px;
  font-size:20px;
  font-weight:900;
  appearance:none;
  -webkit-appearance:none;
  border:2px solid var(--border);
  border-radius:18px;
  background:#fff;
  color:var(--text);
}

#sig{
  overscroll-behavior: contain;
  position:relative;
  width:100%;
  height:320px;
  border:2px solid var(--border);
  border-radius:18px;
  background:#fff;
  display:block;
  touch-action:none; 
  -webkit-user-select:none;
  user-select:none;
}

.btn{
  width:100%;
  border:none;
  border-radius:18px;
  padding:16px;
  font-size:22px;
  font-weight:900;
  cursor:pointer;
  margin-top:12px;
}

.btnClear{ 
  background:#F7E6EC; 
  color:#6B3E4B;
}

.btnSubmit{
  background:#E07A9A;
  color:#fff;
}

.msg{
  margin-top:10px;
  color:var(--danger);
  font-weight:900;
}

.meta{
  color:#6B3E4B;
  font-weight:700;
  line-height:1.6;
}

.sectionTitle{
  font-size:20px; 
  font-weight:900;
  margin: 10px 0 12px;
  padding-left: 6px;
}

.subText{
  color:var(--muted);
  font-weight:700;
  margin:0 0 14px;
  line-height:1.6;
}

.contractBox{
  border:2px solid var(--border);
  border-radius:18px;
  padding:12px;
  background:#fff;
  max-height:360px;
  overflow-y:auto;
  overflow-x:hidden;
}

.contractBox pre{
  margin:0;
  white-space:pre-wrap;
  word-break:break-word;
  line-height:1.8;
  font-size:17px;
  font-weight:700;
  color:var(--text);
  font-family:inherit;
}

.dangerNote{
  color:var(--danger);
  font-weight:900;
  text-align:center;
  margin:14px 0 12px;
  font-size:18px;
}

.checkRow{
  display:flex;
  gap:12px;
  align-items:flex-start;
  margin-top:14px;
}

.checkRow input{
  width:26px;
  height:26px;
  margin-top:2px;
  accent-color:#E07A9A;
}

.checkRow label{
  font-size:20px;
  font-weight:900;
  line-height:1.35;
}

html, body{
  overscroll-behavior: none; 
}

.section-title{
  font-size:20px;
  font-weight:900;
  padding-left: 18px;
  margin: 10px 0 12px;
}

body{
  overflow-x: hidden;
}
</style>


<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="title">寵物美容服務定型化契約</div>
      <div class="meta">
        公司名稱：嗯瑪寵物沙龍<br>
        地址：高雄市路竹區中興路274號<br>
        官方LINE：@roc1545s
      </div>
    </div>

    <div class="section-title">
      契約內容（請完整閱讀）
    </div>

    <div class="contractBox">
      <pre id="contractText">

為保障毛孩的安全與您的權益，
本店採用犬、貓美容服務定型化契約。
請您於簽署前詳閱契約內容，
了解雙方之權利義務及相關服務事項。

另有「犬、貓美容服務簽約前詢問事項及基本資料表」，
將於服務前或到店時填寫，
作為了解毛孩健康狀況、個性與照護需求之依據，
並視為本契約之一部分。

如有任何疑問，
歡迎隨時向我們詢問，
我們將竭誠為您說明，
一同為毛孩提供安心、完善的服務。

【簽約注意事項】
一、
本契約之審閱期間原則上不得少於一日；
如提供單次犬、貓美容服務或有即時必要情形者，
乙方仍應給予甲方即時或合理之審閱期間。
但審閱期間經雙方合意另行約定者，不在此限。

二、
乙方應於簽訂本契約前，
提供「犬、貓美容服務簽約前詢問事項及基本資料表」（如附件），
並由甲、乙雙方就相關內容共同填妥。
乙方並應出示本定型化契約書空白文本，
逐條向甲方說明契約內容，
使甲方充分瞭解其權利與義務。

三、
本契約雖屬定型化契約之一種，
甲、乙雙方仍得依個別情形，
經雙方合意後增、刪或修改契約內容。
雙方不得以本契約內容係主管機關所定為由，
主張不得修改，
亦不得為有利於己之修正後，
宣稱為政府機關版本而主張不得再行變更。

四、
甲方於首次接受乙方提供之犬、貓美容服務前，
應填寫乙方所提供之「毛孩資料卡」，
視為本契約之一部分，
與本契約具有同一法律效力。
毛孩資料卡得以紙本或電子方式製作，一式兩份，
由甲、乙雙方各執一份為憑。
甲方應確保所填資料之真實性與完整性，
並於資料有變更時主動告知乙方；
因資料不實、遺漏或未即時告知，
致乙方於合理專業注意範圍內仍無法預防之風險或損害者，
相關責任概由甲方自行負責。

－－－－－－－－－－      
        
立契約書人
消費者姓名：_____(以下簡稱甲方)
企業經營者：嗯瑪寵物沙龍(以下簡稱乙方)

本契約經甲方完成簽署後即生效，
除非依本契約約定或經雙方書面或電子方式合意終止外，持續有效，
並適用於甲方委託乙方提供之所有犬、貓美容相關服務，
甲方無須於每次服務時重複簽署。
甲乙雙方同意就本契約所載條款及附件內容辦理：
第 一 條 (契約目的與範圍)
犬、貓美容服務，指提供犬、貓外表部位清洗或清潔、吹乾梳毛、毛髮修剪及造型設計等美容服務之行為。但不得涉及動物醫療行為及宣稱醫療效能。

第 二 條 (資訊揭露義務)
乙方應至少以半開大小以上紙張或以電子方式，將犬、貓美容服務定型化契約公告於營業櫃台或場所明顯處；有設置網站或經營社群媒體者，並應於網頁明顯處公告。

第 三 條 (寵物、甲方及乙方相關資料)
本契約應記載寵物、甲方及乙方之下列基本資料（如附件）：
(一)寵物：犬、貓之寵物登記晶片號碼。
但犬、貓未辦理寵物登記者，得提供其他足以辨識個體身分之資訊。
(二)甲方：
1. 姓名：
2. 國民身分證統一編號/居留證號碼：
3. 通訊地址：
4. 聯絡電話：
5. 緊急聯絡人：
6. 緊急聯絡人之聯絡電話：
7. 犬、貓需緊急就醫時指定之獸醫診療場所
(三)乙方：
1. 公司或商號名稱：嗯瑪寵物沙龍
2. 代表人或負責人姓名：陳玫任
3. 營業地址：高雄市路竹區中興路274號
4. 營業時間：10:00-18:00 （週五公休）
5. 聯絡電話：07-6966885
6. 犬、貓需緊急就醫時如無指定，送交之獸醫診療場所

第 四 條 (服務內容之說明及確認) 
乙方應將甲方所選擇之美容服務項目、期間、次數、有無約定指定服務人員、費用及其支付方式，於訂約前向甲方充分說明。乙方應將實施之犬、貓美容服務內容製作紀錄，經甲方簽名確認後，提供正本予甲方留存。前項紀錄之提供及甲方確認之方式，乙方得以書面、電子或其他適當之方式為之。乙方收取犬、貓美容服務費用，應開立憑證予甲方。

第 五 條 (乙方詢問及照護義務)
乙方於實施犬、貓美容服務前，應向甲方詢問犬、貓個性、是否具攻擊性、有無疾病、病史等生理狀況或其他特殊須注意事項，並檢查犬、貓現況，以判斷是否合適接受犬、貓美容服務；甲方對於乙方之詢問應誠實告知。前項詢問，應製作紀錄經甲方簽名確認後，提供正本予甲方留存。前項紀錄之提供及甲方確認之方式，乙方得以書面、電子或其他適當之方式為之。乙方於美容服務實施期間，應提供犬、貓安全、乾淨、通風、排水、適當與適量之遮蔽、照明及溫度之環境，並符合下列規定：
(一)有提供食物或飲水時，應確保其適當、乾淨且無害。
(二)以籠子、繩或鍊圈限制犬、貓活動時，其籠內空間應足供犬、貓充分伸展，其繩或鍊應長於犬、貓身形且足供其充分伸展及活動。
(三)應避免犬、貓遭受騷擾、虐待或傷害。
(四)有發生危害之虞時，應將犬、貓移置安全處，進行妥善照顧。
(五)運輸接送犬、貓時，應注意其食物、飲水、排泄、 環境及安全，並避免犬、貓遭受驚嚇、痛苦或傷害。
(六)提供犬、貓其他妥善之照顧。

第 六 條 (犬、貓於美容服務期間有異常狀況或死亡情形之處理)
於美容服務期間，乙方發現犬、貓實施美容部位或生理健康有異常狀況時，應立即妥善處理，嗣後並通知甲方或其指定之緊急聯絡人。犬、貓有緊急就醫必要時，除立即通知甲方或其指定之緊急聯絡人外，乙方應優先將犬、貓送往甲方指定之獸醫診療機構；甲方未指定獸醫診療機構時，乙方應將犬、貓就近送往適當之獸醫診療機構，並將犬、貓就診之獸醫診療機構聯絡方式提供予甲方或其指定之緊急聯絡人。犬、貓於美容服務期間死亡，或有經乙方送往獸醫診療機構後死亡之情形，乙方應即通知甲方或其指定之緊急聯絡人，妥善保存犬、貓遺體，並向動物保護主管機關報備。甲方經通知後，當日未領回犬、貓遺體時，乙方至遲應於次日將犬、貓遺體交由動物保護主管機關處理。發生第一項或前項之情形，為可歸責於乙方之事由所致者，乙方應負損害賠償及動物保護法相關責任。

第 七 條（甲方繳款方式及預付儲值金約定）
甲方應負擔契約總金額之繳交方式如下：
□現金。
□銀行轉帳。
□信用卡。
□其他方式：________________。
前項繳款方式，得依實際服務內容及雙方約定方式辦理。
（預付儲值金之約定）
甲方得依乙方公告或雙方另行約定之方案，預付一定金額作為犬、貓美容服務之儲值金額（以下稱儲值金）。儲值金僅限用於折抵乙方提供之犬、貓美容相關服務費用，不得折換現金，亦不得轉讓予第三人使用。儲值金之使用方式、適用項目、優惠內容及有效期限（如有），依乙方於儲值時所公告或另行告知之內容為準，並視為本契約之一部分。儲值金原則上不設使用期限，惟如有特殊方案另行約定者，不在此限。如本契約依法解除或終止，尚未使用之儲值金，乙方應依本契約及相關法令規定辦理退還。甲方確認已於儲值前充分了解儲值方案內容，並同意依其約定方式使用。
  
第 八 條 (犬、貓美容服務實施前，甲方任意解除契約之退費規定)
犬、貓美容服務實施前，甲方得隨時解除契約。犬、貓美容服務實施前，因甲方任意解除本契約者，乙方應於解約日後三日內，將已收取之費用全額退還予甲方，不另收取任何解約手續費。

第 九 條 (犬、貓美容服務實施後，甲方任意終止契約之退費規定)
犬、貓美容服務實施後，甲方得隨時終止契約。但單次服務，不適用之。犬、貓美容服務實施後，因甲方任意終止本契約者，乙方應於終止日後三日內將已收取之費用扣除已接受美容服務費用及依前條第三項之手續費後退還於甲方。未依前條第三項約定手續費之金額時，乙方不得扣除手續費。前項扣除已接受美容服務費用之計算方式，依下列原則辦理：
一、非屬預付儲值服務者，應以甲方實際已接受並完成之犬、貓美容服務項目，依乙方當次實際收取之服務單價計算。
二、屬預付儲值服務者，已使用之儲值金額，應依甲方實際已接受並完成之服務項目，按乙方當時公告或雙方另行約定之折抵方式，自甲方實際支付之儲值金額中優先扣除；實際支付金額用罄後，始得折抵乙方基於促銷或優惠所附贈之金額或服務內容。
三、前項儲值服務之退費，僅就甲方實際支付之未使用金額部分辦理；乙方基於促銷、回饋或優惠所附贈之金額、次數或服務內容，不列入退費計算範圍。

第 十 條 (可歸責於乙方，甲方解除或終止契約之退費規定)
乙方有下列事由之一者，未經甲方之同意，甲方得解除或 終止本契約：
(一)將本契約之全部或部分委由其分支機構或其他犬、貓美容服務業者代為履行。
(二)變更服務地點。
(三)變更甲方指定之犬、貓美容服務人員。
前項情形，乙方應於解除或終止後三日內退還相關費用予甲方；甲方另受有損害時，並應賠償。前項相關費用之計算，應以已收取之費用扣除前條第三項勾選計算之費用。

第 十一 條 (不可歸責於雙方，解除或終止契約之退費規定)
有下列事由之一者，契約雙方得於犬、貓美容服務實施前 解除或實施後終止契約：
(一)因天災、事變、政府法令等不可抗力 或不可歸責於雙方當事人之事由，致不能履約。
(二)犬、貓因死亡、疾病、健康情形不佳或抗拒接受美容服務，致難以繼續接受本契約之服務。前項情形，乙方應依第八條或第九條規定退還費用予甲方。但不得扣除手續費。

第 十二 條 (甲方逾時接回犬、貓之處理方式)
乙方完成犬、貓美容服務後，甲方應依雙方約定時間接回犬、貓。甲方接回犬、貓之時間已逾約定時間者，乙方之處理方式 如下：已同意收取逾時費，每小時新臺幣壹佰元。逾時未滿三十分鐘不收取逾時費，逾時三十分鐘起開始計算逾時費，其超過部分，未滿三十分鐘者，以半小時計算；超過三十分鐘以上未滿一小時者，以一小時計算。甲方未於當日營業時間內，依雙方約定時間接回犬、貓者，乙方應通知甲方或其緊急聯絡人。
經通知仍未接回，或無法聯繫時，乙方得於善盡照護義務之前提下，持續代為照護犬、貓，並得向甲方收取逾時照護費。前項逾時照護費之計算方式如下：每小時新臺幣壹佰元；未滿三十分鐘不計費，逾三十分鐘起以一小時計算。前述逾時照護費，每日最高不逾該次美容服務費用之三倍。甲方逾三日未接回犬、貓者，乙方應通知動物保護主管機關依動物保護法相關規定處理。
  
第 十三 條 (不可歸責於甲方，未接回犬、貓之處理方式) 
因天災、事變、政府法令等不可抗力或不可歸責於甲方之事由，致甲方無法於約定時間內接回犬、貓者，乙方應安置犬、貓。乙方提出履行前項安置犬、貓已支付之必要費用並經核實者，得請求甲方償還。於安置期間，發生就醫需要或死亡之情形，依第六條規定辦理。第一項事由發生時，乙方最遲應於可正常通訊之次日通知動物保護主管機關知悉。事件原因消滅後，乙方應通知甲方或其緊急聯絡人接回犬、貓，並依前條規定辦理。甲方當日未接回犬、貓時，乙方應於次日通知動物保護主管機關依動物保護法相關規定處理。

第 十四 條（費用明確性原則）
本契約之費用，包含犬、貓美容服務所需之商品、材料費、服務費及指定服務人員費等項目，其實際金額，應依甲方當次選擇之服務內容、 項目及乙方公告之收費標準或雙方另行約定之金額為準。乙方應於服務前，向甲方清楚說明當次服務之項目及費用；未經說明或未經甲方同意之費用，乙方不得另行向甲方收取。因繳費或儲值而獲得贈送之商品、金額或服務內容，屬促銷或優惠性質，於本契約解除或終止時，乙方不得向甲方請求返還該贈送內容，亦不得主張自返還之費用金額中扣除其價額。
  
第 十五 條（預收犬、貓美容服務費用之履約保障）
乙方如有預收犬、貓美容服務費用之情形，原則上應依相關法令規定提供履約保障。但本契約所約定之服務，屬單次或非長期固定期限之 犬、貓美容服務，且甲方未使用之預收費用金額未達新臺幣一萬元者，依相關法令規定，乙方得不另行提供履約保障，前項履約保障方式亦不適用之。
  
第 十六 條 (個人資料保護) 
乙方因本契約而知悉或持有甲方之個人資料，應予保密並依個人資料保護法相關規定辦理，非經甲方書面同意，乙方不得對外揭露或為契約目的範圍外之利用；契約關係消滅後，亦同。

第 十七 條 (違約賠償) 
因可歸責於當事人一方之事由違反本契約條款，致他方遭受損害，應負損害賠償責任。

第 十八 條 (履行輔助人) 
就本契約之履行，經甲方同意將本契約之全部或部分委由其他犬、貓美容服務業者代為履行者，該受託犬、貓美容服務業者，視為乙方之代理人或使用人。
  
第 十九 條 (申訴處理) 
甲方對乙方提供之犬、貓美容服務有不滿意時，乙方應指派專人接受申訴。因本契約所生爭議，雙方應儘量以協商方式處理。甲方向所在地消費者保護官、消費爭議調解委員會、鄉(鎮、市、區)公所調解委員會申請調解時，乙方應配合前往辦理。
 
第 二十 條 (管轄法院) 
因本契約涉訟者，甲乙雙方同意以新北地方法院為第一審管轄法院。但不得排除消費者保護法第四十七條或民事訴訟法第四百三十六條之九有關小額訴訟管轄法院之適用。

第 二十一 條 (契約及其相關附件效力) 
本契約自簽約日起生效，雙方各執一份契約正本。本契約廣告及相關附件視為本契約之一部分。
  
第 二十二 條（附件之效力）
本契約之附件「犬、貓美容服務簽約前詢問事項及基本資料表（包含但不限於寵物基本資料、健康狀況、個性傾向、病史、 服務項目及相關告知事項），為本契約之一部分，與本契約具有同一之效力。甲方確認已於簽訂本契約前，依乙方之說明完整填寫前述附件，並同意其內容作為乙方評估是否提供犬、貓美容服務及服務方式之依據。前述附件得以書面、電子文件、拍照、掃描或其他可供日後查證之方式留存，均視為有效。
  
__
______________________________________________。
立契約書人
甲方(消費者)
姓名：
國民身分證統一編號或居留證號碼：
聯絡電話：
地址：
乙方(企業經營者)
代表人姓名：陳玫任
公司/商號名稱：嗯瑪寵物沙龍
營業地址：高雄市路竹區中興路274號
聯絡電話：07-6966885
中 華 民 國 年 月 日
</pre>
      </div>

      <div class="checkRow">
        <input id="agree" type="checkbox">
        <label for="agree">我已完整閱讀並同意上述契約內容</label>
      </div>
    </div>

    <div class="card">
      <div class="sectionTitle">甲方資料填寫</div>
      <div class="subText">請填寫以下資料以完成契約簽署</div>

      <div class="label">甲方姓名（飼主）</div>
      <input id="ownerName" class="input" placeholder="請輸入飼主姓名">

      <div class="label">身分證字號</div>
      <input id="ownerIdNo" class="input" placeholder="請輸入身分證字號">

      <div class="label">聯絡電話</div>
      <input id="ownerPhone" class="input" inputmode="tel" placeholder="請輸入聯絡電話">

      <div class="label">通訊地址</div>
      <input id="ownerAddress" class="input" placeholder="請輸入通訊地址">

      <div class="label">寵物姓名</div>
      <input id="petName" class="input" placeholder="請輸入寵物姓名">

      <div class="label">寵物品種</div>
      <input id="petBreed" class="input" placeholder="例：比熊犬">

      <div class="label">體重（公斤）</div>
      <input id="petWeight" class="input" inputmode="decimal" placeholder="例：6.5">

      <div class="label">審閱 / 簽署日期</div>
<input type="date" class="input" id="signDate">

    </div>

    
    <div class="card">
      <div class="label" style="margin-top:0">甲方簽名</div>

      <div id="sigWrap">
        <canvas id="sig"></canvas>
      </div>

      <div class="dangerNote">簽名完成後將自動回傳至聊天室</div>

      <button id="clear" class="btn btnClear" type="button">清除簽名</button>
<div id="msg" class="msg"></div>

<button id="submit" class="btn btnSubmit" type="button">送出簽名</button>

  </div>

<script>
(function(){

  const LIFF_ID = "2008892606-mYSuuVLL";
  const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyBOREOb5Qx9dYQ4wBlhdtMo7iWLd8QtMTe553XvBtyNiUi8NgDWanXKbsWmz46R8g3/exec";
  const SHARED_SECRET = "0626";

  const canvas = document.getElementById("sig");
  const clearBtn = document.getElementById("clear");
  const submitBtn = document.getElementById("submit");
  const msg = document.getElementById("msg");

  const agree = document.getElementById("agree");

  const ownerName = document.getElementById("ownerName");
  const ownerIdNo = document.getElementById("ownerIdNo");
  const ownerPhone = document.getElementById("ownerPhone");
  const ownerAddress = document.getElementById("ownerAddress");
  const petName = document.getElementById("petName");
  const petBreed = document.getElementById("petBreed");
  const petWeight = document.getElementById("petWeight");
  const signDate = document.getElementById("signDate");

  const afterSendModal = document.getElementById("afterSendModal");
  const btnBackToScreenshot = document.getElementById("btnBackToScreenshot");
  const btnCloseToLINE = document.getElementById("btnCloseToLINE");
  const afterSendBar = document.getElementById("afterSendBar");
  const btnCloseToLINE2 = document.getElementById("btnCloseToLINE2");

  const ctx = canvas.getContext("2d");
  canvas.style.touchAction = "none";

  function resetSubmit(){
    submitBtn.disabled = false;
    submitBtn.textContent = "送出簽名";
  }

  function setError(t){
    msg.textContent = t || "";
    msg.style.color = "#d21f1f";
  }

  function setOK(t){
    msg.textContent = t || "";
    msg.style.color = "#111";
  }

  function requireValue(inputEl, label){
    const v = (inputEl.value || "").trim();
    if(!v){
      setError(`請填寫：${label}`);
      inputEl.focus();
      resetSubmit();
      return null;
    }
    return v;
  }

  function todayISO(){
    const d = new Date();
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,"0");
    const dd = String(d.getDate()).padStart(2,"0");
    return `${yyyy}-${mm}-${dd}`;
  }
  if(signDate && !signDate.value) signDate.value = todayISO();

  function syncSize(){
    const r = canvas.getBoundingClientRect();
    const dpr = window.devicePixelRatio || 1;
    canvas.width  = Math.round(r.width * dpr);
    canvas.height = Math.round(r.height * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
    ctx.lineWidth = 4;
    ctx.lineCap = "round";
    ctx.lineJoin = "round";
    ctx.strokeStyle = "#111";
  }
  syncSize();

  let drawing = false;
  let hasStroke = false;

  function point(e){
    const r = canvas.getBoundingClientRect();
    return { x: e.clientX - r.left, y: e.clientY - r.top };
  }

  function lockScroll(lock){
    document.body.style.overflow = lock ? "hidden" : "";
    document.body.style.touchAction = lock ? "none" : "";
  }

  function down(e){
    e.preventDefault();
    lockScroll(true);
    drawing = true;
    const p = point(e);
    ctx.beginPath();
    ctx.moveTo(p.x, p.y);
    msg.textContent = "";
  }

  function move(e){
    if(!drawing) return;
    e.preventDefault();
    const p = point(e);
    ctx.lineTo(p.x, p.y);
    ctx.stroke();
    hasStroke = true;
  }

  function up(){
    drawing = false;
    lockScroll(false);
  }

  canvas.addEventListener("pointerdown", down, { passive:false });
  canvas.addEventListener("pointermove", move, { passive:false });
  window.addEventListener("pointerup", up);
  window.addEventListener("pointercancel", up);

  clearBtn.onclick = () => {
    const r = canvas.getBoundingClientRect();
    ctx.clearRect(0, 0, r.width, r.height);
    hasStroke = false;
    setError("已清除，請重新簽名");
    resetSubmit();
  };

  function showAfterSendUI(){
    if(afterSendModal) afterSendModal.style.display = "flex";
    if(afterSendBar) afterSendBar.style.display = "block";
    if(!afterSendModal && !afterSendBar){
      alert("已把簽署資料傳送至聊天室。");
    }
  }

  function closeToLINE(){
    if(window.liff && liff.isInClient()){
      liff.closeWindow();
    }else{
      alert("請從 LINE 聊天室內開啟此頁面");
    }
  }

  if(btnBackToScreenshot){
    btnBackToScreenshot.onclick = () => {
      afterSendModal.style.display = "none";
    };
  }
  if(btnCloseToLINE) btnCloseToLINE.onclick = closeToLINE;
  if(btnCloseToLINE2) btnCloseToLINE2.onclick = closeToLINE;

  async function initLIFF(){
    if(!window.liff){
      throw new Error("LIFF SDK 未載入");
    }
    await liff.init({ liffId: LIFF_ID });
    if(!liff.isInClient()){
      throw new Error("請從 LINE 聊天室開啟此連結");
    }
    if(!liff.isLoggedIn()){
      liff.login();
      return false;
    }
    return true;
  }

  submitBtn.onclick = async () => {
    msg.textContent = "";
    submitBtn.disabled = true;
    submitBtn.textContent = "謝謝您！資料上傳中...";

    

    if(!agree.checked){
      setError("請先勾選同意契約內容");
      resetSubmit();
      return;
    }

    const data = {
      ownerName:    requireValue(ownerName, "甲方姓名"),
      ownerPhone:   requireValue(ownerPhone, "聯絡電話"),
      ownerIdNo:    requireValue(ownerIdNo, "身分證字號"),
      ownerAddress: requireValue(ownerAddress, "通訊地址"),
      petName:      requireValue(petName, "寵物姓名"),
      petBreed:     requireValue(petBreed, "寵物品種"),
      petWeight:    requireValue(petWeight, "體重"),
      signDate:     requireValue(signDate, "簽署日期"),
    };
    if(Object.values(data).some(v => v === null)){
      resetSubmit();
      return;
    }

    if(!hasStroke){
      setError("請先完成簽名");
      resetSubmit();
      return;
    }

    try{
      const ok = await initLIFF();
      if(!ok){
        resetSubmit();
        return;
      }

      const textMsg =
`【犬貓美容契約簽署資料】
甲方姓名：${data.ownerName}
聯絡電話：${data.ownerPhone}
身分證字號：${data.ownerIdNo}
通訊地址：${data.ownerAddress}
寵物名字：${data.petName}
品種：${data.petBreed}
體重(公斤)：${data.petWeight}
審閱/簽署日期：${data.signDate}

（簽署資料與簽名已完成，並已自動上傳至雲端保存。
若有多隻毛孩，請每隻毛孩分別填寫一份表單並各自送出。）`;

      await liff.sendMessages([{ type:"text", text:textMsg }]);

      let profile = null;
      try { profile = await liff.getProfile(); } catch(e){}


      const signatureDataUrl = canvas.toDataURL("image/png");


      try{
        await fetch(GOOGLE_SCRIPT_URL, {
          method: "POST",
          headers: { "Content-Type": "text/plain;charset=UTF-8" },
          body: JSON.stringify({
            secret: SHARED_SECRET,
            data,
            signatureDataUrl,
            line: {
              userId: profile?.userId || "",
              displayName: profile?.displayName || ""
            }
          })
        });
      }catch(e){
        console.warn("Google upload failed:", e);
      }

      showAfterSendUI();
setOK("簽署資料已送出！\n可以回到聊天室了！");
resetSubmit();



    }catch(err){
      setError(err.message || "送出失敗");
      resetSubmit();
    }
  };

})();
</script>



</body>
</html>
